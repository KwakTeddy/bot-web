<script type="text/template" id="inputListModalTemplate">
<ul class="dialog-editor-input-list-modal">
    <li>{{lan('새로만들기') }}</li>
</ul>
</script>

<div ng-controller="DialogGraphEditorController">
    <div class="topicswitch2">
        <span class="mr10">Advanced</span>
        <div class="minislide inline-block" ng-class="isAdvancedMode ? 'on' : ''" ng-click="changeMode($event);">
            <input type="checkbox" value="switch" id="advance" ng-model="isAdvancedMode">
            <label for="advance"></label>
        </div>
    </div>
    <div class="dialog-editor dialog-editor-basic">
        <form ng-submit="save($event);">
            <div class="dialog-editor-body">
                <div class="dialog-editor-row">
                    <p class="dialog-editor-subject">대화 이름</p>
                    <div class="dialog-editor-input-box">
                        <input type="text" class="dialog-editor-input" placeholder="Dialog name" ng-model="dialog.name" ng-required="true">
                    </div>
                </div>



                <div class="dialog-editor-row">
                    <p class="dialog-editor-subject">사용자 입력</p>
                    <div class="dialog-editor-input-box">
                        <div class="dialog-editor-input-wrapper" ng-repeat="input in dialog.input">
                            <input type="text" class="dialog-editor-input" placeholder="{{lan('Keyword, #Intent, @Entity, $Type, /RegExp/, if(Condition)') }}" required="true" style="color: white;">
                            <div class="editable" contenteditable="true" ng-keydown="onKeyDown($event);" ng-mouseup="onFocus($event);" ng-focus="focusGuideBox($event);" ng-keyup="onKeyUp($event)" ng-blur="onBlur($event, $index);" data-index="{{$index}}"></div>
                            <img ng-if="$index > 0" src="/modules/playchat/working-ground/common/client/imgs/delete.png" class="delete-img" ng-click="deleteInput($index);">
                            <span ng-if="$index == dialog.input.length-1" class="dialog-editor-input-plus" ng-click="addInput($event);">+</span>
                        </div>
                        <div class="dialog-editor-input-guide-box">
                            <div class="dialog-editor-input-description"></div>
                            <div class="dialog-editor-input-list-box" ng-show="showInputList">
                                <div class="dialog-editor-input-list-box-title">↓ ↑ to navigate&nbsp;&nbsp;&nbsp; enter to select &nbsp;&nbsp;&nbsp;esc to dismiss</div>
                                <ul></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="dialog-editor-row" ng-if="isAdvancedMode === true">-->
                    <!--<p class="dialog-editor-subject">Input</p>-->
                    <!--<div class="dialog-editor-input-box" style="margin-bottom: 30px;">-->
                        <!--<p class="dialog-editor-advanced-input-placeholder">{{lan('Keyword, #Intent, @Entity, $Type, /RegExp/, if(Condition)') }}</p>-->
                        <!--<div ng-repeat="input in dialog.input">-->
                            <!--<div class="dialog-editor-input-textarea" data-nlu="{{ nlpedTextPrefix[$index] + nlpedText[$index] }}" ng-click="focusToInputArea($event);">-->
                                <!--<span ng-repeat="(key, val) in input" ng-show="getInputKeyLength(input, key) > 0">-->
                                    <!--<span class="dialog-editor-input-item" ng-class="key" ng-click="inputKeyOnClick($event);">-->
                                        <!--<span class="dialog-editor-input-key" contenteditable="true" data-key="{{ key }}" ng-click="inputKeyOnClick($event);" ng-focus="inputKeyOnFocus($event, input);" ng-blur="inputKeyOnBlur($event, input, true);" ng-keydown="inputKeyOnKeyDown($event, input, $parent.$index);" ng-keyup="inputKeyOnKeyUp($event, input, $parent.$index);">{{ getValueName(val); }}</span>-->
                                        <!--<img src="/modules/playchat/working-ground/dialog-graph/client/imgs/close.png" class="delete-img" ng-click="deleteInputKey(input, key);">-->
                                    <!--</span>-->
                                    <!--<span class="and" ng-if="getLength(input);">and</span>-->
                                <!--</span>-->

                                <!--<span class="dialog-editor-input-item">-->
                                    <!--<input type="text" class="dialog-editor-input-key target-input" ng-class="isRequired(input) ? '' : ''" style="width: 80px; padding:0 4px;" ng-click="inputKeyOnClick($event);" ng-focus="inputKeyOnFocus($event, input);" ng-blur="inputKeyOnBlur($event, input, true);" ng-keydown="inputKeyOnKeyDown($event, input);" ng-keyup="inputKeyOnKeyUp($event, input, $index, true);">-->
                                <!--</span>-->
                                <!--<img ng-if="$index > 0" src="/modules/playchat/working-ground/common/client/imgs/delete.png" class="delete-img" ng-click="deleteInput($index);" style="position: absolute; top: 7px; right: 12px;">-->
                            <!--</div>-->
                            <!--<div class="or" ng-if="dialog.input.length > 1 && $index < dialog.input.length-1">-->
                                <!--<span>or</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div style="position: relative;">-->
                            <!--<a href="#" class="dialog-editor-plus-wrapper" ng-click="addInput($event);" tabindex="-1"><span class="dialog-editor-plus"></span></a>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->





                <div class="dialog-editor-row" ng-if="isAdvancedMode === true">
                    <p class="dialog-editor-subject">답변 전 실행 함수</p>
                    <div class="dialog-editor-select-input" style="margin: 0 auto; display: block; width: 93%;">
                        <input type="text" ng-model="dialog.task.name" ng-keydown="taskKeydown($event);" ng-keyup="taskKeyUp($event);">
                        <ul class="dialog-editor-select-options">
                            <li ng-mousedown="createTask(dialog.task.name);">{{lan('Add New') }}</li>
                            <li ng-repeat="task in tasks track by $index" ng-mousedown="selectTask($event, task)">
                                <span data-filename="{{ task.fileName }}">{{ task.name }}</span>
                                <span style="float: right;" ng-mousedown="moveCodeEditor($event, task);">view</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="dialog-editor-row">
                    <p class="dialog-editor-subject">챗봇 답변</p>
                    <a href="#" tabindex="-1" class="dialog-editor-output-add" ng-click="addOutput($event);" tabindex="-1"><img src="/modules/playchat/working-ground/dialog-graph/client/imgs/add.png"></a>
                    <div class="dialog-editor-output-box" ng-repeat="output in dialog.output">
                        <div class="dialog-editor-output-functions">
                            <a href="#" tabindex="-1">
                                <img src="/modules/playchat/working-ground/common/client/imgs/delete.png" class="image-button" ng-click="deleteOutput(dialog.output, $index);">
                            </a>
                        </div>
                        <div ng-if="output.kind == 'Text' || output.kind == 'Content'">
                            <div class="dialog-editor-output-if" ng-if="dialog.output.length > 1 && isAdvancedMode === true">
                                <span>IF</span>
                                <input type="text" class="dialog-editor-output-input if" ng-model="output.if">
                            </div>
                            <div class="dialog-editor-output-text" style="font-size: 0px;">
                                <textarea placeholder="{{ lan('Edit here.') }}" ng-keydown="onKeyDownTextArea($event);" ng-required="isUseOutput === true" ng-model="output.text"></textarea>
                            </div>
                            <div class="dialog-editor-output-box-row button" ng-click="clickToImageFile($event);">
                                <div ng-show="output.uploader.item == 'none'">
                                    <span class="blue-label">{{lan('Add image') }}</span>
                                    <img src="/modules/playchat/working-ground/dialog-graph/client/imgs/blue-arrow.png">
                                </div>
                                <input tabindex="-1" type="file" class="dialog-editor-output-file" nv-file-select uploader="output.uploader" data-index="{{ $index }}">
                                <div class="dialog-editor-output-image-box" ng-show="output.uploader.item != 'none'">
                                    <img style="width: 100%;" ng-src="{{ output.uploader.item }}">
                                    <div>
                                        <p>{{lan('Click to change image') }}</p>
                                        <img src="/modules/playchat/working-ground/dialog-graph/client/imgs/delete-white.png" ng-click="deleteOutputImage($event, $index);">
                                    </div>
                                </div>
                            </div>
                            <div class="dialog-editor-output-box-row" ng-repeat="button in output.buttons">
                                <input tabindex="-1" type="text" class="output-button-name" placeholder="{{ lan('Create a button name.') }}" ng-model="button.text" ng-required="true">
                                <input tabindex="-1" type="text" class="output-button-url" placeholder="{{ lan('Write URL address here.') }}" ng-model="button.url">
                                <img src="/modules/playchat/working-ground/common/client/imgs/delete.png" class="image-button" style="position: absolute; top: 5px; right: 5px;" ng-click="deleteOutputButton(output.buttons, $index);">
                            </div>
                            <div class="dialog-editor-output-box-row button" ng-click="addOutputButton($event, output);">
                                <span class="blue-label">{{lan('Add button') }}</span>
                                <img src="/modules/playchat/working-ground/dialog-graph/client/imgs/blue-arrow.png">
                            </div>
                            <div class="dialog-editor-output-box-row" ng-if="controlDialogFlow">
                                <div style="font-size: 0; text-align: left;">
                                    <div class="select-wrapper">
                                        <select class="jumbo-select dialog-editor-action-type" style="width: 100%; display: block;" ng-model="output.type" ng-change="actionValueChanged(output);">
                                            <option value="">Select dialog flow</option>
                                            <option ng-repeat="action in actionList" value="{{action.key}}">{{action.name}}</option>
                                        </select>
                                    </div>
                                    <div class="dialog-editor-select-input" ng-class="actionTypeCheck === false ? '' : 'disabled'">
                                        <input type="text" ng-model="output.dialog" ng-required="true" placeholder="{{lan('Dialog Input') }}" ng-focus="onActionFocus($event);" ng-keydown="onActionKeyDown($event, output);" ng-keyup="onActionKeyUp($event);">
                                        <ul class="dialog-editor-select-options">
                                            <li ng-repeat="dialog in userDialogs" ng-mousedown="selectActionDialog($event, dialog, output)">{{ dialog.name }}</li>
                                            <li ng-repeat="dialog in commonDialogs" ng-mousedown="selectActionDialog($event, dialog, output)">{{ dialog.name }}</li>
                                        </ul>
                                    </div>
                                    <img src="/modules/playchat/working-ground/common/client/imgs/delete.png" class="image-button" style="position: absolute; top: 9px; right: 12px;" ng-click="deleteActionButton(output);">
                                </div>
                            </div>
                            <div class="dialog-editor-output-box-row button" ng-click="addActionButton($event, output);" ng-if="!controlDialogFlow">
                                <span class="blue-label">{{lan('Add action') }}</span>
                                <img src="/modules/playchat/working-ground/dialog-graph/client/imgs/blue-arrow.png">
                            </div>
                        </div>
                        <div ng-if="output.kind == 'Action' && isAdvancedMode">
                            <div class="dialog-editor-output-action-row">
                                <p class="dialog-editor-output-label">Action</p>
                                <span>IF</span>
                                <input type="text" class="dialog-editor-output-input if" ng-model="output.if">
                            </div>
                            <div class="dialog-editor-output-action-row">
                                <p class="dialog-editor-output-label">Action Type</p>
                                <div class="select-wrapper">
                                    <select class="jumbo-select dialog-editor-action-type" style="width: 100%; margin: 0 auto; display: block;" ng-model="output.type" ng-required="true" ng-change="actionValueChanged(output);">
                                        <option value="">none</option>
                                        <option value="call">Call</option>
                                        <option value="callChild">Call Child</option>
                                        <option value="returnCall">Return Call</option>
                                        <option value="up">Up</option>
                                        <option value="repeat">Repeat</option>
                                        <option value="return">Return</option>
                                    </select>
                                </div>
                            </div>
                            <div class="dialog-editor-output-action-row">
                                <p class="dialog-editor-output-label">{{lan('Dialog Select') }}</p>
                                <div class="dialog-editor-select-input" style="width: 100%; margin: 0 auto; display: block;" ng-disabled="actionTypeCheck === true">
                                    <input type="text" ng-model="output.dialog" ng-required="true" ng-disabled="actionTypeCheck === true">
                                    <ul class="dialog-editor-select-options">
                                        <li ng-repeat="dialog in userDialogs" ng-mousedown="selectActionDialog($event, dialog, output)">{{ dialog.name }}</li>
                                        <li ng-repeat="dialog in commonDialogs" ng-mousedown="selectActionDialog($event, dialog, output)">{{ dialog.name }}</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="dialog-editor-output-action-row">
                                <p class="dialog-editor-output-label">Option</p>
                                <textarea class="dialog-editor-output-input options" ng-model="output.options.output"></textarea>
                                <!--<input type="text" class="dialog-editor-output-input" style="width: 100%;" ng-model="output.options.output">-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-editor-footer">
                <button class="blue-button">{{lan('Save') }}</button>
                <button type="button" class="default-button" ng-click="close();">{{lan('Cancel') }}</button>
            </div>
        </form>
    </div>
</div>
