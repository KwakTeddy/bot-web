<!--
 2015.10.29
 Hong SeongChan (seongchan116@gmail.com)
 -------------------------------------------
 모바일 웹 페이에서 개발하고 있는 앱이 실행이 안되길래 샘플코드를 작성해 봄.
 이 소스의 전제 조건은 uri scheme 방식이 적용된 앱을 기준으로 한다.
 Android 앱의 경우 intent를 이용한 방식을 주로 사용했겠지만, 모바일 웹을 고려한다면 uri scheme을 적용하는게 유리하다.
 (웹쪽 코드가 단순해 진다.)
 아래 코드는 이러한 전제로 작성되었다.
 -->

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name=”viewport” content=”initial-scale = 2.0″>
  <style type="text/css">
    <!--
    body {
      font-size:20pt;
      margin: 10px;
    }
    //-->
  </style>
  <title>Execute App at (Mobile)WebPage</title>
  <script>
    var androidUrl = '{{androidUrl}}';
    var androidStore = '{{androidStore}}';
    var iosUrl = '{{iosUrl}}';
    var iosStore = '{{iosStore}}';

    var os = "";
    // 아래는 OS 구분에 대한 부분은 예시 코드다.  모바일이 아닌 경우도 고려해야 한다.
    if(navigator.userAgent.toLocaleLowerCase().search("iphone") > -1){
      os = "ios";
    }else{
      os = "android";
    }

    // 스토어 URL 정보는 각 패키지가 등록된 후에 확인 가능하다.
    function goAppStoreOrPlayStore() {
      var storeURL ="";
      if (os == "ios") {
        storeURL = "http://itunes.apple.com/app/" + iosStore;
      } else {
        storeURL = "https://play.google.com/store/apps/details?id=" + androidStore;
      }
      location.replace(storeURL);
    }

    function executeApp() {
      if (os == "ios") {
        document.location.href = iosUrl;
      } else {
        document.location.href = androidUrl;
      }

//      var appUriScheme = "example://launch?version=1";
//      document.location.href = appUriScheme;
    }
    // 이 코드는 대부분 사용하는 코드다.
    function executeAppOrGoStore() {
      var openAt = new Date;
      setTimeout(
              function() {
                if (new Date - openAt < 1000)
                  goAppStoreOrPlayStore();
              }, 500);
      executeApp();
    }

    window.onload = function(e) {
      executeAppOrGoStore()
    };

  </script>
</head>
<center>
  웹에서 앱 실행이 안되길때 짜집기로 짠다. <br /><br />
  <a href="#" onclick="javascript:goAppStoreOrPlayStore()">스토어 열기</a><br /><br />
  <a href="#" onclick="javascript:executeApp()">앱 실행</a> <br /><br />
  <a href="#" onclick="javascript:executeAppOrGoStore()">있으면 실행하고 없으면 스토어로 가자</a>
</center>
<body>
</body>
</html>


